<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Asynchronous Streams with Generators</title>
  <script src="../../../AppData/Local/Temp/index.js"></script>
</head>
<body>
  <h1>Asynchronous Streams with Generators</h1>

  <button onclick="count()">Get value from server</button>
  <button onclick="getSequence()">Get values from server</button>

  <br>
  <br>

  <button onclick="coroutine(generator())">Click me</button>


  <script>
    // function ex(gen) {
    //   var iterator = gen();
    //
    //   function next(itNext) {
    //     if(itNext.done) {
    //       return;
    //     }
    //     itNext.value
    //     .then(result => next(iterator.next(result)))
    //     .catch(error => iterator.throw(error));
    //   }
    //
    //   next(iterator.next());
    // }
    //
    // ex(function* () {
    //   const start = Date.now();
    //
    //   for (var i = 1; i < drivers; i++) {
    //     try {
    //       const result = yield login(i);
    //
    //       tokens.push({
    //         token: result.token,
    //         driver: `${USER}${i}`
    //       });
    //     } catch (error) {
    //       console.log('::ERROR::', error.message || 'Unknown error', `::${USER}${i}`);
    //     }
    //   }
    // });

    const fetchPost = index => fetch(`https://jsonplaceholder.typicode.com/post/${index}`).then(response => response.json());
    // const fetchComments = id => fetch(`https://jsonplaceholder.typicode.com/posts/${id}/comments`).then(response => response.json());

    function* generator () {
      try {
        // const promises = posts.map(({id}) => fetchComments(id));
        // const comments = yield Promise.all(promises);
        // showComments(comments);

        for (let i = 1; i < 10; i++) {
          const post = yield fetchPost();
          console.error('post', post);
        }
      } catch (err) {
        console.error(`Error: ${err}`)
      }
    }

    function coroutine(iterator) {
      const doNext = step => {
        const {done, value} = step.next();

        console.error('done', done);
        console.error('value', value);


        if (!done) {
          return value
            .then(result => console.error('result', result))
            .catch(error => iterator.throw(error));
        }
      };

      doNext(iterator);
    }

    // coroutine(generator());

    // function showComments (comments) {
    //   console.error('comments', comments);
    // }

    // function co (iterator) {
    //   const next = iteration => {
    //     const {done, value} = iteration;
    //
    //     if (done) return;
    //
    //     value
    //       .then(result => next(iterator.next(result)))
    //       .catch(error => iterator.throw(error));
    //   };
    //
    //   next(iterator.next());
    // }
  </script>
</body>
</html>
